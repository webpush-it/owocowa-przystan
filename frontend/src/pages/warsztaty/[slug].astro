---
import Layout from '../../layouts/Layout.astro'
import Header from '../../components/Header.astro'
import Footer from '../../components/Footer.astro'
import { client, urlFor, type Workshop } from '../../lib/sanity'

export async function getStaticPaths() {
    const query = `*[_type == "workshop"]{slug}`
    const workshops = await client.fetch(query)

    return workshops.map((workshop: any) => ({
        params: { slug: workshop.slug?.current },
    }))
}

const { slug } = Astro.params
const query = `*[_type == "workshop" && slug.current == $slug][0]`
const workshop = await client.fetch<Workshop>(query, { slug })

if (!workshop) return Astro.redirect('/404')
---

<Layout title={workshop.title}>
    <Header />

    <article class="max-w-4xl mx-auto px-4 py-12 md:py-20">
        <a href="/#oferta" class="inline-block mb-6 text-stone-500 hover:text-[#C84C38] transition">
            &larr; Wróć do oferty
        </a>

        <h1 class="text-4xl md:text-5xl font-bold text-[#2F5233] mb-6">{workshop.title}</h1>

        <div class="flex flex-wrap gap-4 mb-8 text-sm font-bold text-stone-600 uppercase tracking-wide">
            <span class="bg-[#E8E6df] px-3 py-1 rounded">Czas: {workshop.duration}</span>
            <span class="bg-[#E8E6df] px-3 py-1 rounded">Dla: {workshop.targetGroup}</span>
        </div>

        {workshop.mainImage && (
                <img
                        src={urlFor(workshop.mainImage).width(1200).height(600).url()}
                        alt={workshop.title}
                        class="w-full h-auto rounded-2xl shadow-lg mb-12"
                />
        )}

        <div class="prose prose-lg prose-stone max-w-none">
            <p>{workshop.description}</p>
        </div>

        <div class="mt-12 p-8 bg-[#F9F7F2] border border-[#2F5233]/20 rounded-xl text-center">
            <h3 class="text-2xl font-bold text-[#2F5233] mb-4">Zainteresowany tymi zajęciami?</h3>
            <a href="/#kontakt" class="bg-[#C84C38] text-white px-8 py-3 rounded-full font-bold hover:bg-[#a63a29] transition inline-block">
                Zadzwoń i umów termin
            </a>
        </div>
    </article>

    <Footer/>

</Layout>
